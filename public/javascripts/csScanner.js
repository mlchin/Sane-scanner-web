function clearElement(elementId){const el=document.getElementById(elementId);for(;el.firstChild;)el.removeChild(el.firstChild)}function showFeedback(message){var feedback=document.getElementById("feedback_area");feedback.appendChild(document.createElement("h6")),feedback.firstChild.style.color="blue",feedback.firstChild.classList.add("text-bold"),feedback.firstChild.innerHTML=message}function isFilenameValid(){document.getElementById("btnScan").disabled=!0,clearElement("err_message");let filename=document.getElementById("filename").value;if(filename=filename.trim(),""===filename)return;if(/^[0-9a-zA-Z_][0-9a-zA-Z_-]*$/.test(filename)){const radios=document.getElementsByName("scanFormat");let extension="";for(let i=0;i<radios.length;i++)radios[i].checked&&(extension=radios[i].value);filename=filename+"."+extension.trim();var xhr=new XMLHttpRequest;xhr.open("GET","/javascripts/filenames.txt",!0),xhr.responseType="json",xhr.onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){if(xhr.response.files.includes(filename)){var error_text=document.createElement("h6");error_text.innerHTML="WARNING: Duplicate filename found. If you proceed, previous file will be <u>overwritten</u>.",error_text.classList.add("help-block","text-bold"),error_text.style.color="#FF6400",document.getElementById("err_message").appendChild(error_text)}else document.getElementById("btnScan").disabled=!1}},xhr.send()}else{var error_text=document.createElement("h6");error_text.appendChild(document.createTextNode("ERROR: Invalid filename.  Only alphanumeric, dash(-) & underscore(_) allowed. Try again.")),error_text.classList.add("help-block","text-bold"),error_text.style.color="red",document.getElementById("err_message").appendChild(error_text)}}function flipDisplay(currentstatus){const el=document.getElementById("scannerStatus");"on"===currentstatus?(el.dataset.currentstatus="off",el.parentNode.classList.add("alert-danger"),el.parentNode.classList.remove("alert-success"),el.classList.add("text-bold"),el.innerHTML="Scanner not found. Check device connection and make sure device is powered on."):(el.dataset.currentstatus="on",el.parentNode.classList.add("alert-success"),el.parentNode.classList.remove("alert-danger"),el.classList.add("text-bold"),el.innerHTML="Scanner detected. Ready to scan.")}function clientsidePoll(){const currentstatus=document.getElementById("scannerStatus").dataset.currentstatus;let url="";url="on"===currentstatus?"/poll?status=on":"/poll?status=off";const xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="json",xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(xhr.response.update&&flipDisplay(currentstatus),clientsidePoll())},xhr.send()}function checkConfig(){document.title="Check Configuration";const rows=document.getElementsByClassName("jumbotron")[0].firstElementChild.getElementsByClassName("row");rows[1].getElementsByTagName("h4")[0].innerText="Check Scanner Settings";rows[2].getElementsByTagName("h5")[0].innerHTML="Select PROCEED to scan, or, CANCEL to start again";var radioResolutions=document.getElementsByName("scanResolution");for(let i=0;i<radioResolutions.length;i++)if(radioResolutions[i].checked)var resolution=radioResolutions[i].value;else radioResolutions[i].disabled=!0;var radioModes=document.getElementsByName("scanMode");for(let i=0;i<radioModes.length;i++)if(radioModes[i].checked)var mode=radioModes[i].value;else radioModes[i].disabled=!0;var radioFormats=document.getElementsByName("scanFormat");for(let i=0;i<radioFormats.length;i++)if(radioFormats[i].checked)var format=radioFormats[i].value;else radioFormats[i].disabled=!0;document.getElementById("filename").readOnly=!0;var filename=document.getElementById("filename").value.trim();/^[0-9a-zA-Z_][0-9a-zA-Z_-]*$/.test(filename)||alert("Filename fail validation. Hacking detected? Start again...");var scanimage_cmd="scanimage --verbose --resolution="+resolution+" --mode="+mode+" --format="+format+" > "+("/home/pi/ScanDocuments/"+filename+"."+format);scanimage_cmd=(scanimage_cmd=scanimage_cmd.replace("colour","color")).replace("monochrome","gray");const button_section=document.getElementById("button_section");for(;button_section.firstChild;)button_section.removeChild(button_section.firstChild);button_section.appendChild(document.createElement("div"));const alert_div=button_section.firstChild;alert_div.classList.add("alert","alert-success"),alert_div.setAttribute("role","alert"),alert_div.style.marginTop="10px",alert_div.appendChild(document.createElement("h4")),alert_div.lastChild.innerHTML="Scanimage command line:",alert_div.lastChild.classList.add("text-bold"),alert_div.appendChild(document.createElement("h5")),alert_div.lastChild.innerHTML=scanimage_cmd,button_section.appendChild(document.createElement("button")),button_section.lastChild.classList.add("btn","btn-danger"),button_section.lastChild.type="submit",button_section.lastChild.innerHTML="Proceed",button_section.lastChild.style.marginRight="5px";button_section.lastChild.addEventListener("click",(function(){showFeedback("Please wait. Scanning in progress... Screen will refresh when process completes.")})),button_section.appendChild(document.createElement("button")),button_section.lastChild.classList.add("btn","btn-default"),button_section.lastChild.type="button",button_section.lastChild.innerHTML="Cancel",button_section.lastChild.addEventListener("click",(function(){location.href="/scanner"}))}